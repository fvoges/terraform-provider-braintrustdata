name: Documentation

on:
  pull_request:
    paths:
      - 'internal/provider/**'
      - 'templates/**'
      - 'examples/**'
      - '.github/workflows/docs.yml'
  push:
    branches:
      - main

permissions:
  contents: read

jobs:
  validate-docs:
    name: Validate Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Set up Go
        uses: actions/setup-go@v6
        with:
          go-version-file: 'go.mod'
          cache: true

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.14.x

      - name: Install tfplugindocs
        run: go install github.com/hashicorp/terraform-plugin-docs/cmd/tfplugindocs@latest

      - name: Generate documentation
        run: make generate

      - name: Check for uncommitted changes
        run: |
          git diff --exit-code docs/ || \
            (echo "Documentation is out of date. Run 'make generate' and commit the changes." && exit 1)

      - name: Validate examples
        run: |
          if [ -d examples ]; then
            for f in $(find examples -name "*.tf"); do
              echo "Validating $f"
              terraform fmt -check "$f" || exit 1
            done
          fi
